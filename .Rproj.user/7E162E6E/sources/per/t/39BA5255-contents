if (!require(xlsx)) {
  install.packages("xlsx", repos = "http://cran.us.r-project.org")
  require(xlsx)
}
if (!require(ggplot2)) {
  install.packages("ggplot2", repos = "http://cran.us.r-project.org")
  require(ggplot2)
}
if(!require(RColorBrewer)){
  install.packages("RColorBrewer", repos = "http://cran.us.r-project.org")
  library(RColorBrewer)
}
if(!require(viridis)){
  install.packages("viridis", repos = "http://cran.us.r-project.org")
  library(viridis)
}
if (!require(dplyr)) {
  install.packages("dplyr", repos = "http://cran.us.r-project.org")
  require(dplyr)
}
if (!require(matlab)) {
  install.packages("matlab", repos = "http://cran.us.r-project.org")
  require(matlab)
}
if (!require(car)) {
  install.packages("car", repos = "http://cran.us.r-project.org")
  require(car)
}
if (!require(lattice)) {
  install.packages("lattice", repos = "http://cran.us.r-project.org")
  require(lattice)
}
if (!require(FSA)) {
  install.packages("FSA", repos = "http://cran.us.r-project.org")
  require(FSA)
}
if (!require(rcompanion)) {
  install.packages("rcompanion", repos = "http://cran.us.r-project.org")
  require(rcompanion)
}
if (!require(coin)) {
  install.packages("coin", repos = "http://cran.us.r-project.org")
  require(coin)
}
if (!require(gridExtra)) {
  install.packages("gridExtra", repos = "http://cran.us.r-project.org")
  require(gridExtra)
}
if (!require(grid)) {
  install.packages("grid", repos = "http://cran.us.r-project.org")
  require(grid)
}
if (!require(reshape)) {
  install.packages("reshape", repos = "http://cran.us.r-project.org")
  require(reshape)
}
if (!require(extrafont)) {
  install.packages("extrafont", repos = "http://cran.us.r-project.org")
  require(extrafont)
}
if (!require(viridis)) {
  install.packages("viridis", repos = "http://cran.us.r-project.org")
  require(viridis)
}
if (!require(alluvial)) {
  install.packages("alluvial", repos = "http://cran.us.r-project.org")
  require(alluvial)
}

BAEA <- read.csv("csv/Technical_Drawing_I_II - BAEA.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEE <- read.csv("csv/Technical_Drawing_I_II - BAEE.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEC <- read.csv("csv/Technical_Drawing_I_II - BAEC.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEP <- read.csv("csv/Technical_Drawing_I_II - BAEP.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEQ <- read.csv("csv/Technical_Drawing_I_II - BAEQ.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BALF <- read.csv("csv/Technical_Drawing_I_II - BALF.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")

BAEA <- BAEA[,-10]
colnames(BAEC)[10] <- "TOTAL_CARGA_HORARIA"

all_data <- rbind(BAEA, BAEE)
all_data <- rbind(all_data, BAEC)
all_data <- rbind(all_data, BAEP)
all_data <- rbind(all_data, BAEQ)
all_data <- rbind(all_data, BALF)

all_data$NOME_PESSOA[is.na(all_data$NOME_PESSOA)]
all_data$NOME_PESSOA[all_data$NOME_PESSOA == ""]

all_data$MATR_ALUNO[is.na(all_data$MATR_ALUNO)]
all_data$MATR_ALUNO[all_data$NOME_PESSOA == ""]

all_data$COD_CURSO[is.na(all_data$COD_CURSO)]
all_data$COD_CURSO[all_data$COD_CURSO == ""]
unique(all_data$COD_CURSO)

all_data$ANO[is.na(all_data$ANO)]
all_data$ANO <- as.numeric(all_data$ANO)
unique(all_data$ANO)
#all_data$ANO[all_data$ANO > 2019 | all_data$ANO < 2006]

all_data$PERIODO[is.na(all_data$PERIODO)]
all_data$PERIODO[all_data$PERIODO == ""]
unique(all_data$PERIODO)

all_data$COD_ATIV_CURRIC[is.na(all_data$COD_ATIV_CURRIC)]
all_data$COD_ATIV_CURRIC[all_data$COD_ATIV_CURRIC == ""]
unique(all_data$COD_ATIV_CURRIC)

all_data$NOME_ATIV_CURRIC[is.na(all_data$NOME_ATIV_CURRIC)]
all_data$NOME_ATIV_CURRIC[all_data$NOME_ATIV_CURRIC == ""]
unique(all_data$NOME_ATIV_CURRIC)

all_data$CREDITOS <- as.numeric(all_data$CREDITOS)
all_data$CREDITOS[is.na(all_data$CREDITOS)]
unique(all_data$CREDITOS)

all_data$MEDIA_FINAL <- as.numeric(all_data$MEDIA_FINAL)
all_data$MEDIA_FINAL[is.na(all_data$MEDIA_FINAL)]
all_data$MEDIA_FINAL[all_data$MEDIA_FINAL > 10 | all_data$MEDIA_FINAL < 0] 
all_data$MEDIA_FINAL[all_data$MEDIA_FINAL > 10 | all_data$MEDIA_FINAL < 0] <- 0

all_data$DESCR_SITUACAO[all_data$DESCR_SITUACAO == ""]
all_data$DESCR_SITUACAO[is.na(all_data$DESCR_SITUACAO)]
unique(all_data$DESCR_SITUACAO)

all_data$TOTAL_CARGA_HORARIA <- as.numeric(all_data$TOTAL_CARGA_HORARIA)
all_data[is.na(all_data$TOTAL_CARGA_HORARIA),]
all_data$TOTAL_CARGA_HORARIA[is.na(all_data$TOTAL_CARGA_HORARIA)] <- 60
unique(all_data$TOTAL_CARGA_HORARIA)

all_data$FORMA_INGRESSO[all_data$FORMA_INGRESSO == ""]
all_data$FORMA_INGRESSO[is.na(all_data$FORMA_INGRESSO)]
unique(all_data$FORMA_INGRESSO)

all_data$ANO_INGRESSO <- as.numeric(all_data$ANO_INGRESSO)
all_data$ANO_INGRESSO[is.na(all_data$ANO_INGRESSO)]
unique(all_data$ANO_INGRESSO)

all_data$ANO_EVASAO <- as.numeric(all_data$ANO_EVASAO)
all_data$ANO_EVASAO[is.na(all_data$ANO_EVASAO)]
all_data$ANO_EVASAO[is.na(all_data$ANO_EVASAO)] <- 0
unique(all_data$ANO_EVASAO)

all_data <- all_data[all_data$DESCR_SITUACAO != "Dispensado sem nota",]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Aproveitamento" & all_data$MEDIA_FINAL == 0),]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Trancamento parcial"),]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Matrícula"),]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Disciplina Não Concluída"),]

all_data <- all_data[all_data$DESCR_SITUACAO != "Dispensado sem nota",]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Aproveitamento" & all_data$MEDIA_FINAL == 0),]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Trancamento parcial"),]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Matrícula"),]
all_data <- all_data[!(all_data$DESCR_SITUACAO == "Disciplina Não Concluída"),]

by_course_drawing_I <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2]
    )
)

by_year_drawing_I <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(ANO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_course_drawing_I <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(ANO, COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_semester_course_drawing_I <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(ANO, COD_CURSO, PERIODO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_course_drawing_II <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2]
    )
)

by_year_drawing_II <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(ANO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_course_drawing_II <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(ANO, COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_semester_course_drawing_II <- as.data.frame(
  all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(ANO, COD_CURSO, PERIODO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

unique(all_data$FORMA_EVASAO)
all_data$FORMA_EVASAO[(all_data$FORMA_EVASAO == "Transf. Interna Por Reopção de Curso")] <- "Reop??o"
all_data$FORMA_EVASAO[(all_data$FORMA_EVASAO == "Transferência Interna")] <- "Transf. Interna"

all_data_without_frequency_dropout <- all_data[!(all_data$DESCR_SITUACAO == "Reprovado por Frequência"),]

by_course_drawing_I_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2]
    )
)

by_year_drawing_I_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(ANO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_course_drawing_I_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(ANO, COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_semester_course_drawing_I_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",] %>% 
    group_by(ANO, COD_CURSO, PERIODO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_course_drawing_II_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2]
    )
)

by_year_drawing_II_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(ANO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_course_drawing_II_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(ANO, COD_CURSO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

by_year_semester_course_drawing_II_2 <- as.data.frame(
  all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",] %>% 
    group_by(ANO, COD_CURSO, PERIODO) %>% 
    summarise(mean = mean(MEDIA_FINAL), 
              median = median(MEDIA_FINAL), 
              sd = sd(MEDIA_FINAL), 
              min = min(MEDIA_FINAL), 
              max = max(MEDIA_FINAL),
              n = NROW(MEDIA_FINAL),
              quartil_1st = summary(MEDIA_FINAL)[2],
              quartil_3rd = summary(MEDIA_FINAL)[5],
              IQR = summary(MEDIA_FINAL)[5] - summary(MEDIA_FINAL)[2])
)

x <- rep(1:length(unique(all_data$FORMA_EVASAO)))
boxplot(MEDIA_FINAL~FORMA_EVASAO,
        data=all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",],
        main="Disciplina de Desenho Tecnico I",
        xlab="Formas de Evasao",
        ylab="Média Final",
        col=rainbow(length(unique(x))),
        border="black"
)

boxplot(MEDIA_FINAL~FORMA_EVASAO,
        data=all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",],
        main="Disciplina de Desenho Tecnico II",
        xlab="Formas de Evasao",
        ylab="Média Final",
        col=rainbow(length(unique(x))),
        border="black"
)

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
       aes(x = COD_CURSO, y = MEDIA_FINAL, fill = COD_CURSO)) +
       geom_violin(trim = TRUE) + 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x=0, y=6, xend=7, yend=6),linetype="dotted", colour="red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       xlab("Curso") + ylab("Media Final") + labs(fill = "Curso") + ggtitle("Desenho Tecnico I") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
       aes(x = ANO, y = MEDIA_FINAL, fill = as.factor(ANO), group = ANO)) +
       geom_violin(trim = TRUE)+ 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x=2007, y=6, xend=2019, yend=6), linetype="dotted",colour="red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       scale_x_continuous(breaks = seq(2007, 2019, by = 1)) +
       xlab("Ano") + ylab("Média Final") + labs(fill = "Ano") + ggtitle("Desenho Técnico I") +
       theme(plot.title = element_text(hjust = 0.5))
        
ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
       aes(x = as.factor(ANO), y = MEDIA_FINAL, fill = as.factor(PERIODO))) +
       geom_violin(trim = FALSE) +
       geom_segment(aes(x = 0, y = 6, xend = 13, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       theme(legend.position = "bottom") +
       xlab("ANO") + ylab("Média Final") + labs(fill = "Período") + ggtitle("Desenho Técnico I") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
       aes(x = COD_CURSO, y = MEDIA_FINAL, fill = COD_CURSO)) +
       geom_violin(trim = TRUE)+ 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x=0, y=6, xend=7, yend=6), linetype="dotted", colour="red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       xlab("Curso") + ylab("Média Final") + labs(fill = "Curso") + ggtitle("Desenho Técnico II") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
       aes(x = ANO, y = MEDIA_FINAL, fill = as.factor(ANO), group = ANO)) +
       geom_violin(trim = TRUE)+ 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x = 2007, y = 6, xend = 2019, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       scale_x_continuous(breaks = seq(2007, 2019, by = 1)) +
       xlab("Ano") + ylab("Média Final") + labs(fill = "Ano") + ggtitle("Desenho Técnico II") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
       aes(x = as.factor(ANO), y = MEDIA_FINAL, fill = as.factor(PERIODO))) +
       geom_violin(trim = TRUE) +
       geom_segment(aes(x = 0, y = 6, xend = 13, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       theme(legend.position = "bottom") +
       xlab("Ano") + ylab("Média Final") + labs(fill = "Período") + ggtitle("Desenho Técnico II") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
       aes(x = COD_CURSO, y = MEDIA_FINAL, fill = COD_CURSO)) +
       geom_violin(trim = TRUE) + 
       geom_boxplot(width = 0.1) +
       geom_segment(aes(x=0, y=6, xend=7, yend=6), linetype="dotted", colour="red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) + 
       xlab("Curso") + ylab("Média Final") + labs(fill = "Curso") + ggtitle("Médias em Desenho Técnico I (Sem Reprovações por Frequência)") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
       aes(x = ANO, y = MEDIA_FINAL, fill = as.factor(ANO), group = ANO)) +
       geom_violin(trim = TRUE)+ 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x = 2007, y = 6, xend = 2019, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       scale_x_continuous(breaks = seq(2007, 2019, by = 1)) +
       xlab("Ano") + ylab("Média Final") + labs(fill = "Ano") + ggtitle("Médias em Desenho Técnico I (Sem Reprovações por Frequência)") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
       aes(x = as.factor(ANO), y = MEDIA_FINAL, fill = as.factor(PERIODO))) +
       geom_violin(trim = TRUE, position = dodge) + 
       geom_boxplot(width = 0.1, position = dodge) +
       geom_segment(aes(x = 0, y = 6, xend = 13, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       theme(legend.position = "bottom") +
       xlab("ANO") + ylab("Média Final") + labs(fill = "Período") + ggtitle("Médias em Desenho Técnico I (Sem Reprovações por Frequência)") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
       aes(x = COD_CURSO, y = MEDIA_FINAL, fill = COD_CURSO)) +
       geom_violin(trim = TRUE)+ 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x=0, y=6, xend=7, yend=6), linetype="dotted", colour="red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       xlab("Curso") + ylab("Média Final") + labs(fill = "Curso") + ggtitle("Médias em Desenho Técnico II (Sem Reprovações por Frequência)") +
       theme(plot.title = element_text(hjust = 0.5))

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
       aes(x = ANO, y = MEDIA_FINAL, fill = as.factor(ANO), group = ANO)) +
       geom_violin(trim = TRUE)+ 
       geom_boxplot(width = 0.1) + 
       geom_segment(aes(x = 2007, y = 6, xend = 2019, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       scale_x_continuous(breaks = seq(2007, 2019, by = 1)) +
       xlab("Ano") + ylab("Média Final") + labs(fill = "Ano") + ggtitle("Médias em Desenho Técnico II (Sem Reprovações por Frequência)") +
       theme(plot.title = element_text(hjust = 0.5))

dodge <- position_dodge(width = 0.9)
ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
       aes(x = as.factor(ANO), y = MEDIA_FINAL, fill = as.factor(PERIODO))) +
       geom_violin(trim = TRUE)+
       geom_boxplot(width = 0.1, position = dodge) + 
       geom_segment(aes(x = 0, y = 6, xend = 13, yend = 6), linetype = "dotted", colour = "red") +
       scale_y_continuous(breaks = seq(0, 10, by = 1)) +
       theme(legend.position = "bottom") +
       xlab("ANO") + ylab("Média Final") + labs(fill = "Período") + ggtitle("Médias em Desenho Técnico II (Sem Reprovações por Frequência)") +
       theme(plot.title = element_text(hjust = 0.5))

frequency_dropout_data <- all_data[(all_data$DESCR_SITUACAO == "Reprovado por Frequência"),]

ggplot(frequency_dropout_data, 
       aes(SEXO, fill=as.factor(SEXO))) + 
       geom_bar() +
       scale_fill_hue(c = 40) +
       scale_y_continuous(breaks = seq(0, 500, by = 50)) +
       xlab("Sexo") + ylab("Número de Reprovações") + labs(fill = "Sexo") + ggtitle("Reprovações por Frequência (Desenho Técnico I e II)") +
       theme(plot.title = element_text(hjust = 0.5))


aux <- frequency_dropout_data %>%
  group_by(SEXO,NOME_ATIV_CURRIC) %>%
  tally()

ggplot(aux, aes(NOME_ATIV_CURRIC, n, group = SEXO, fill=as.factor(SEXO))) + 
  geom_bar(stat="identity", color="black", position=position_dodge()) +
  scale_fill_hue(c = 40) +
  scale_y_continuous(breaks = seq(0, 400, by = 50)) +
  xlab("Disciplina") + ylab("Número de Reprovações") + labs(fill = "Sexo") + ggtitle("Reprovações por Frequência") +
  theme(plot.title = element_text(hjust = 0.5))


aux <- frequency_dropout_data %>%
  group_by(SEXO,NOME_ATIV_CURRIC,ANO) %>%
  tally()

ggplot(aux, aes(ANO, n, fill=as.factor(SEXO))) + 
  geom_bar(stat="identity", color="black", position=position_dodge()) +
  scale_fill_hue(c = 40) +
  ylab("Frequência") + labs(fill = "Sexo") + ggtitle("Reprovações por Frequência") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(breaks = seq(0, 50, by = 5)) +
  scale_x_continuous(breaks = round(seq(min(aux$ANO), max(aux$ANO), by = 1),1)) +
  facet_wrap(~NOME_ATIV_CURRIC) 


aux <- frequency_dropout_data %>%
  group_by(NOME_ATIV_CURRIC,PERIODO,ANO) %>%
  tally()

ggplot(aux, aes(NOME_ATIV_CURRIC, n, fill=as.factor(PERIODO))) + 
  geom_bar(stat="identity", color="black", position=position_dodge()) +
  scale_fill_hue(c = 50) +
  ylab("Frequência") + xlab("Disciplina") + labs(fill = "Disciplina") + ggtitle("Reprovações por Frequência") +
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(face = "bold", size = 8)) +
  facet_wrap(~ANO) 


aux <- frequency_dropout_data %>%
  group_by(NOME_ATIV_CURRIC,FORMA_EVASAO) %>%
  tally()

ggplot(aux, aes(NOME_ATIV_CURRIC, n, fill=as.factor(FORMA_EVASAO))) + 
  geom_bar(stat="identity", width = 0.5, color = "black", position=position_dodge()) +
  scale_fill_hue(c = 50) +
  scale_y_continuous(breaks = seq(0, 300, by = 25)) +
  ylab("Frequência") + labs(fill = "Tipo de Evasão")  + xlab("Disciplina") + ggtitle("Situação de Alunos Reprovados por Frequência") +
  theme(plot.title = element_text(hjust = 0.5, size = 12), axis.text.x = element_text(face = "bold", size = 10)) 

aux <- all_data %>%
  group_by(NOME_ATIV_CURRIC,DESCR_SITUACAO,ANO) %>%
  tally()

ggplot(aux, aes(NOME_ATIV_CURRIC, n, fill=as.factor(DESCR_SITUACAO))) + 
  geom_bar(stat="identity", width = 0.5, color = "black", position=position_dodge()) +
  scale_fill_hue(c = 50) +
  ylab("Frequência") + labs(fill = "Disciplina") + xlab("Disciplina") + ggtitle("Aprovações e Reprovações por Ano e Disciplina") +
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(face = "bold", size = 7)) +
  facet_wrap(~ANO) 

aux <- as.data.frame(all_data %>%
  group_by(ANO,DESCR_SITUACAO,NOME_ATIV_CURRIC) %>%
  tally())

ggplot(aux, aes(ANO, n, group = DESCR_SITUACAO, color = DESCR_SITUACAO)) + 
  geom_line(size=1.5) +
  geom_point(size=3, shape=21, fill="white") +
  scale_x_continuous(breaks = round(seq(min(aux$ANO), max(aux$ANO), by = 1),1)) +
  scale_y_continuous(breaks = round(seq(0, max(aux$n), by = 10),1)) +
  ylab("Frequência") + labs(color = "Situação do Aluno") + ggtitle("Aprovações e Reprovações por Ano e Disciplina") +
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(face = "bold", size = 8)) +
  facet_wrap(~NOME_ATIV_CURRIC) 

aux <- as.data.frame(all_data %>%
                       group_by(ANO,DESCR_SITUACAO,NOME_ATIV_CURRIC) %>%
                       tally())
aux <- as.data.frame(aux %>% 
                       group_by(ANO, NOME_ATIV_CURRIC) %>% 
                       mutate(percent = 100*(n/sum(n))))

ggplot(aux, aes(ANO, percent, group = DESCR_SITUACAO, color = DESCR_SITUACAO)) + 
  geom_line(size=1.5) +
  geom_point(size=3, shape=21, fill="white") +
  scale_x_continuous(breaks = round(seq(min(aux$ANO), max(aux$ANO), by = 1),1)) +
  scale_y_continuous(breaks = round(seq(0, 100, by = 10),1)) +
  ylab("Percentual de Alunos (%)") + labs(color = "Situação do Aluno") + ggtitle("Aprovações e Reprovações por Ano e Disciplina") +
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(face = "bold", size = 8)) +
  facet_wrap(~NOME_ATIV_CURRIC) 

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
  aes(x = MEDIA_FINAL , fill = as.factor(ANO))) +
  geom_density(color = "black") + xlab("Média Final") + ylab("Densidade") + labs(fill = "Ano") +
  ggtitle("Distribuição das Médias em Desenho Técnico I (Sem Reprovações por Frequência)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  facet_wrap(c("ANO","PERIODO"))

ggplot(all_data_without_frequency_dropout[all_data_without_frequency_dropout$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
  aes(x = MEDIA_FINAL , fill = as.factor(ANO))) +
  geom_density(color = "black") + xlab("Média Final") + ylab("Densidade") + labs(fill = "Ano") +
  ggtitle("Distribuição das Médias em Desenho Técnico II (Sem Reprovações por Frequência)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  facet_wrap(c("ANO","PERIODO"))

ggplot(all_data_without_frequency_dropout,
  aes(x = ANO, y = MEDIA_FINAL)) +
  ggtitle("Densidade das Médias por Ano (Sem Reprovações por Frequência)") +
  ylab("Média Final") + xlab("Ano") + labs(fill = "Densidade") +      
  stat_density2d(aes(fill = ..density..), contour = F, geom = 'tile') +
  scale_fill_distiller(palette = 7) +
  geom_segment(aes(x = 2007, y = 6, xend = 2019, yend = 6), linetype = "dotted", colour = "black") +
  geom_segment(aes(x = 2007, y = 7, xend = 2019, yend = 7), linetype = "dotted", colour = "black") +
  geom_segment(aes(x = 2016, y = 0, xend = 2016, yend = 10), linetype = "dotted", colour = "black") +
  geom_segment(aes(x = 2018, y = 0, xend = 2018, yend = 10), linetype = "dotted", colour = "black") +
  scale_x_continuous(expand = c(0, 0), breaks = seq(2007, 2019, by = 1)) +
  theme(panel.spacing = unit(2, "lines"), plot.title = element_text(hjust = 0.5), axis.text.x = element_text(face = "bold", size = 8)) +
  scale_y_continuous(expand = c(0, 0), breaks = seq(0, 10, by = 1)) +
  facet_wrap(~NOME_ATIV_CURRIC)

alluvial(all_data_without_frequency_dropout[1:100,c(1:2,10,12,14)],alpha = 0.6,cex=0.7,cex.axis=0.7, freq=60,  border = ifelse(all_data_without_frequency_dropout$MEDIA_FINAL >= 6 , "green", "black") ,col=ifelse(all_data_without_frequency_dropout$MEDIA_FINAL >= 6, "green", "red"))

# Pressuposições e testes estatísticos de diferenças de médias entre os anos para Desenho I

# Análise das variâncias por ano da disciplina.
aggregate(MEDIA_FINAL ~ ANO, all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], var)

# Teste I: Teste da homogeneidade das variâncias por ano. OK.
bartlett.test(MEDIA_FINAL ~ ANO, all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",])
# p-valor > 0.05 : Aceita-se H0, conclui-se que as vari?ncias s?o constantes ou homog?neas.

# Teste II: Teste de normalidade dos resíduos. FALHA.
res = residuals(lm(MEDIA_FINAL ~ ANO, data = all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",]))
shapiro.test(res)
# p-valor < 0.05 : Rejeita-se H0, conclui-se que as distribui??es n?o seguem uma distribui??o normal.

# An?lise da homogeneidade das distribui??es das m?dias por ano.
kruskal.test(MEDIA_FINAL ~ ANO, all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",])
# p-valor < 0.05 : Rejeita-se H0, conclui-se que as distribui??es entre os anos n?o s?o homog?neas.
# Dados n?o seguem distribui??o normal e n?o possuem a mesma distribui??o.

# An?lise do tamanho do efeito no c?lculo das diferen?as
freemanTheta(x = all_data$MEDIA_FINAL[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"], 
             g = all_data$ANO[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"])
# 0.16 
# effect size = 1 indica que as m?dias de cada grupo s?o inteiramente maiores/menores que outros grupos 
# effect size = 0 indica que n?o h? efeito; os grupos s?o estoc?sticamente absolutamente iguais

# An?lise do tamanho do efeito no c?lculo das diferen?as par a par
multiVDA(x = all_data$MEDIA_FINAL[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"], 
         g = all_data$ANO[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"])
# 2008-2014 possui a diferen?a mais significativa entre as m?dias

all_data$ANO = as.factor(all_data$ANO)
levels(all_data$ANO)

# An?lise de quais grupos diferem entre si(dunn Test)
#options("scipen"=100, "digits"=4)
PT = dunnTest(MEDIA_FINAL ~ ANO,
              data=all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",],
              method="bh") 
PT = PT$res
PT

# An?lise de quais grupos diferem entre si (Mann-Whitney U-tests)
PT = pairwise.wilcox.test(all_data$MEDIA_FINAL[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"],
                          all_data$ANO[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"],
                          p.adjust.method="fdr")
PT
PT = PT$p.value 
PT1 = fullPTable(PT)
PT1

library(multcompView)
multcompLetters(PT1,
                compare="<",
                threshold=0.05, # p-value to use as significance threshold
                Letters=letters,
                reversed = FALSE)


densityplot(~ MEDIA_FINAL | ANO, 
          data=all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], xlab = "M?dia Final", ylab = "Percentual Total")









# Pressuposi??es e testes estat?sticos de diferen?as de m?dias entre os anos para Desenho I

# An?lise das vari?ncias por ano da disciplina.
aggregate(MEDIA_FINAL ~ ANO, all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], var)

# Teste I: Teste da homogeneidade das vari?ncias por ano. FALHA.
bartlett.test(MEDIA_FINAL ~ ANO, all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",])
# p-valor > 0.05 : Rejeita-se H0, conclui-se que as vari?ncias s?o heterog?neas entre os anos.

# Teste II: Teste de normalidade dos res?duos. FALHA.
res = residuals(lm(MEDIA_FINAL ~ ANO, data = all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",]))
shapiro.test(res)
# p-valor < 0.05 : Rejeita-se H0, conclui-se que as distribui??es n?o seguem uma distribui??o normal.

# An?lise da homogeneidade das distribui??es das m?dias por ano.
kruskal.test(MEDIA_FINAL ~ ANO, all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",])
# p-valor < 0.05 : Rejeita-se H0, conclui-se que as distribui??es entre os anos n?o s?o homog?neas.
# Dados n?o seguem distribui??o normal e n?o possuem a mesma distribui??o.

# An?lise do tamanho do efeito no c?lculo das diferen?as
freemanTheta(x = all_data$MEDIA_FINAL[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"], 
             g = all_data$ANO[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"])
# 0.16 
# effect size = 1 indica que as m?dias de cada grupo s?o inteiramente maiores/menores que outros grupos 
# effect size = 0 indica que n?o h? efeito; os grupos s?o estoc?sticamente absolutamente iguais

# An?lise do tamanho do efeito no c?lculo das diferen?as par a par
multiVDA(x = all_data$MEDIA_FINAL[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"], 
         g = all_data$ANO[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"])
# 2008-2014 possui a diferen?a mais significativa entre as m?dias

all_data$ANO = as.factor(all_data$ANO)
levels(all_data$ANO)

# An?lise de quais grupos diferem entre si(dunn Test)
#options("scipen"=100, "digits"=4)
PT = dunnTest(MEDIA_FINAL ~ ANO,
              data=all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",],
              method="bh") 
PT = PT$res
PT

# An?lise de quais grupos diferem entre si (Mann-Whitney U-tests)
PT = pairwise.wilcox.test(all_data$MEDIA_FINAL[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"],
                          all_data$ANO[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I"],
                          p.adjust.method="fdr")
PT
PT = PT$p.value 
PT1 = fullPTable(PT)
PT1

library(multcompView)
multcompLetters(PT1,
                compare="<",
                threshold=0.05,
                Letters=letters,
                reversed = FALSE)

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",], 
        aes(x = MEDIA_FINAL , fill = as.factor(ANO))) +
        geom_density(color = "black") + xlab("M?dia Final") + ylab("Densidade") + labs(fill = "Ano") +
        ggtitle("Distribui??o das M?dias em Desenho T?cnico I (Sem Reprova??es por Frequ?ncia)") +
        theme(plot.title = element_text(hjust = 0.5)) +
        facet_wrap(~ANO)

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",], 
        aes(x = MEDIA_FINAL , fill = as.factor(ANO))) +
        geom_density(color = "black") + xlab("M?dia Final") + ylab("Densidade") + labs(fill = "Ano") +
        ggtitle("Distribui??o das M?dias em Desenho T?cnico II (Sem Reprova??es por Frequ?ncia)") +
        theme(plot.title = element_text(hjust = 0.5)) +
        facet_wrap(~ANO)

library(viridis)

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO I",],
        aes(x = MEDIA_FINAL, y = ANO)) +
        ggtitle("Densidade das M?dias por Ano em Desenho T?cnico I (Sem Reprova??es por Frequ?ncia)") +
        xlab("M?dia Final") + ylab("Ano") + labs(fill = "Densidade") +      
        stat_density2d(aes(fill = ..density..), contour = F, geom = 'tile') +
        scale_fill_distiller(palette=4, direction=1) +
        scale_x_continuous(expand = c(0, 0)) +
        scale_y_continuous(expand = c(0, 0)) 

ggplot(all_data[all_data$NOME_ATIV_CURRIC == "DESENHO TECNICO II",],
        aes(x = MEDIA_FINAL, y = ANO)) +
        ggtitle("Densidade das M?dias por Ano em Desenho T?cnico II (Sem Reprova??es por Frequ?ncia)") +
        xlab("M?dia Final") + ylab("Ano") + labs(fill = "Densidade") +         
        stat_density2d(aes(fill = ..density..), contour = F, geom = 'tile') +
        scale_fill_distiller(palette=4, direction=1) +
        scale_x_continuous(expand = c(0, 0)) +
        scale_y_continuous(expand = c(0, 0))

## Dados do professor espec?fico ##
alexandro <- read.csv("csv/historico.csv",sep=";", stringsAsFactors=FALSE, encoding = "utf8")
unique(alexandro$situa??o)
alexandro <- alexandro[(alexandro$situa??o != "Trancamento parcial" & alexandro$situa??o != "Dispensado sem  nota" & alexandro$situa??o != "Disciplina N?o Conclu?da"),]
unique(alexandro$curso)
alexandro <- alexandro[(alexandro$curso != "ESPPOS" & alexandro$curso != "BAMCA" & alexandro$curso != "ESPG"),]
unique(alexandro$componente.curricular)
alexandro <- alexandro[(alexandro$componente.curricular != "BA000184-CONFIABILIDADE DE PROCESSOS E PRODUTOS" & alexandro$componente.curricular != "BA000258-GEOPROCESSAMENTO E TOPOGRAFIA" & alexandro$componente.curricular != "BA000188-MODELAGEM DA INFORMACAO" & alexandro$componente.curricular != "BA000254-SENSORIAMENTO REMOTO APLICADO A ENGENHARIA"),]
unique(alexandro$ano.periodo)
unique(alexandro$turma)
alexandro[alexandro$nota<0 | alexandro$nota>10,]

BAEA <- read.csv("csv/Dados Desenho T?cnico I e II - BAEA.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEE <- read.csv("csv/Dados Desenho T?cnico I e II - BAEE.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEC <- read.csv("csv/Dados Desenho T?cnico I e II - BAEC.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEP <- read.csv("csv/Dados Desenho T?cnico I e II - BAEP.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BAEQ <- read.csv("csv/Dados Desenho T?cnico I e II - BAEQ.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")
BALF <- read.csv("csv/Dados Desenho T?cnico I e II - BALF.csv",sep=";", stringsAsFactors=FALSE, encoding = "Latin-1")

BAEA <- BAEA[,-11]
colnames(BAEC)[11] <- "TOTAL_CARGA_HORARIA"

all_data <- rbind(BAEA, BAEE)
all_data <- rbind(all_data, BAEC)
all_data <- rbind(all_data, BAEP)
all_data <- rbind(all_data, BAEQ)
all_data <- rbind(all_data, BALF)

all_data_sex <- all_data[,c(1,16)]
all_data_sex <- all_data_sex %>% distinct(NOME_PESSOA, .keep_all = TRUE)
alexandro <- merge(x = alexandro, y = all_data_sex, by.x = "nome", by.y = "NOME_PESSOA", all.x=TRUE)

alexandro[is.na(alexandro$SEXO),]
alexandro[alexandro$nome == "ADILSON DO NASCIMENTO SOARES",]$SEXO = 'M'
alexandro[alexandro$nome == "ALESSANDRA C?CO MACIEL",]$SEXO = 'F'
alexandro[alexandro$nome == "ALEXANDRE FONTES OLIVEIRA",]$SEXO = 'M'
alexandro[alexandro$nome == "AMANDA RODRIGUES BRAVO",]$SEXO = 'F'
alexandro[alexandro$nome == "ANA PAULA JARDIM ROQUETE",]$SEXO = 'F'
alexandro[alexandro$nome == "ANDRE LUIS GUTERRES VICENZI",]$SEXO = 'M'
alexandro[alexandro$nome == "ANTONIO ORSINI SCARDOELLI NETO",]$SEXO = 'M'
alexandro[alexandro$nome == "AURIDIAN FERNANDES DE SOUSA",]$SEXO = 'M'
alexandro[alexandro$nome == "CAETANO FLORES DE MOURA",]$SEXO = 'M'
alexandro[alexandro$nome == "CECILIA FERRO DA CUNHA",]$SEXO = 'F'
alexandro[alexandro$nome == "CESAR MACKE OLIVEIRA",]$SEXO = 'M'
alexandro[alexandro$nome == "CL?UDIA GARRASTAZU RIBEIRO",]$SEXO = 'F'
alexandro[alexandro$nome == "CLAUSQUIM DO NASCIMENTO ANTUNES",]$SEXO = 'M'
alexandro[alexandro$nome == "CLEITON DOS SANTOS VIDART",]$SEXO = 'M'
alexandro[alexandro$nome == "CRISTIANO GARCIA MILANO",]$SEXO = 'M'
alexandro[alexandro$nome == "DAIANE COSTA GONCALVES",]$SEXO = 'F'
alexandro[alexandro$nome == "DANIEL THOMAZI MENDES",]$SEXO = 'M'
alexandro[alexandro$nome == "DANIELA DANIGNO KONRADT",]$SEXO = 'F'
alexandro[alexandro$nome == "DIEGO PAULO DE MELLO",]$SEXO = 'M'
alexandro[alexandro$nome == "DIEGO PINHEIRO DOS SANTOS",]$SEXO = 'M'
alexandro[alexandro$nome == "EMANUEL ANTUNES VIEIRA",]$SEXO = 'M'
alexandro[alexandro$nome == "FERNANDA EMANUELE RAUBER BELINAZZO",]$SEXO = 'F'
alexandro[alexandro$nome == "GABRIEL DAVILA CAMARGO",]$SEXO = 'M'
alexandro[alexandro$nome == "GLEITON ARIEL GUEDES PIRES",]$SEXO = 'M'
alexandro[alexandro$nome == "GUILHERME DORNELES LONGARA",]$SEXO = 'M'
alexandro[alexandro$nome == "GUILHERME SEVERO ZANDOMENEGHI",]$SEXO = 'M'
alexandro[alexandro$nome == "HEIKA NAIARA FERREIRA VILLAFANE",]$SEXO = 'F'
alexandro[alexandro$nome == "IGOR HELLWIG BAUMBACH",]$SEXO = 'M'
alexandro[alexandro$nome == "ILSON GILMAR GUST",]$SEXO = 'M'
alexandro[alexandro$nome == "IVO FERRONATO JUNIOR",]$SEXO = 'M'
alexandro[alexandro$nome == "JONATHAN ABEJANEDA SILVA",]$SEXO = 'M'
alexandro[alexandro$nome == "LEANDRO BARBOSA DA MARTA",]$SEXO = 'M'
alexandro[alexandro$nome == "LETICIA  AGUZZI PERES",]$SEXO = 'F'
alexandro[alexandro$nome == "LETICIA LEITE RODRIGUES",]$SEXO = 'F'
alexandro[alexandro$nome == "LIDIANI PINHEIRO LENZ",]$SEXO = 'F'
alexandro[alexandro$nome == "LUCAS AMADEU MULLER",]$SEXO = 'M'
alexandro[alexandro$nome == "LUCAS DREGER FARIA",]$SEXO = 'M'
alexandro[alexandro$nome == "LUCAS FEKSA RAMOS",]$SEXO = 'M'
alexandro[alexandro$nome == "LUCIANO BORGES SILVEIRA",]$SEXO = 'M'
alexandro[alexandro$nome == "MADSON VAZ RAMOS",]$SEXO = 'M'
alexandro[alexandro$nome == "MARIA SIBILA DA SILVA",]$SEXO = 'F'
alexandro[alexandro$nome == "MATIAS ROSA DE BRITTO",]$SEXO = 'M'
alexandro[alexandro$nome == "MURIELE  DE OLIVEIRA D'AVILA",]$SEXO = 'F'
alexandro[alexandro$nome == "NEWTON PERIMA MANSUR MUNHOZ",]$SEXO = 'M'
alexandro[alexandro$nome == "PRISCILA SILVEIRA EBERT",]$SEXO = 'F'
alexandro[alexandro$nome == "RAFAEL RONDON MESQUITA",]$SEXO = 'M'
alexandro[alexandro$nome == "ALEXANDRE RODRIGUES RIBAS",]$SEXO = 'M'
alexandro[alexandro$nome == "RAFAEL WERLE ARENHART",]$SEXO = 'M'
alexandro[alexandro$nome == "RAPHAEL PEREIRA DA SILVA",]$SEXO = 'M'
alexandro[alexandro$nome == "RENATO FONSECA PEDROTTI",]$SEXO = 'M'
alexandro[alexandro$nome == "RODOLFO CARINGI MAJER",]$SEXO = 'M'
alexandro[alexandro$nome == "RONALDO DA SILVEIRA OLIVEIRA",]$SEXO = 'M'
alexandro[alexandro$nome == "RUBEM ANDERSON SCHMIT RAHMEIER",]$SEXO = 'M'
alexandro[alexandro$nome == "SAMUEL FERREIRA MACHADO",]$SEXO = 'M'
alexandro[alexandro$nome == "SERGIO FREDERICO  PIRES DIAS",]$SEXO = 'M'
alexandro[alexandro$nome == "UHIL ROBSON DO NASCIMENTO ANTUNES",]$SEXO = 'M'

## Quem desiste mais nas disciplinas por sexo e disciplina?
alexandro$componente.curricular[alexandro$componente.curricular == "010801-DESENHO TECNICO I"] <- "DESENHO TECNICO I"
alexandro$componente.curricular[alexandro$componente.curricular == "010803-DESENHO TECNICO II"] <- "DESENHO TECNICO II"
alexandro$componente.curricular[alexandro$componente.curricular == "BA010801-DESENHO TECNICO I"] <- "DESENHO TECNICO I"
alexandro$componente.curricular[alexandro$componente.curricular == "BA010803-DESENHO TECNICO II"] <- "DESENHO TECNICO II"

alexandro$ano <- as.numeric(substr(alexandro$ano.periodo, 1, 4))
alexandro$periodo <- substr(alexandro$ano.periodo, 8, 18)

aux <- as.data.frame(
    alexandro %>% 
    group_by(SEXO, componente.curricular) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

ggplot(aux, aes(componente.curricular, mean, group = SEXO, fill=as.factor(SEXO))) + 
  geom_bar(stat="identity", color="black", position=position_dodge()) +
  scale_fill_hue(c = 40) +
  xlab("Disciplina") + ylab("M?dia da Nota Final") + labs(fill = "Sexo") + ggtitle("An?lise de M?dias por Disciplina e Sexo") +
  theme(plot.title = element_text(hjust = 0.5))

aux <- as.data.frame(
    alexandro %>% 
    group_by(ano, periodo, componente.curricular) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

ggplot(aux, aes(as.factor(ano), mean, group = componente.curricular, fill=as.factor(periodo))) + 
  geom_bar(stat="identity", color="black", position= position_dodge2(preserve = "single")) +
  scale_fill_hue(c = 40) +
  xlab("Ano") + ylab("M?dia da Nota Final") + labs(fill = "Per?odo") + ggtitle("An?lise de M?dias por Disciplina e Sexo") +
  theme(axis.text.x = element_text(face = "bold", size = 6), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~componente.curricular)

ggplot(aux, aes(as.factor(ano), n, group = componente.curricular, fill=as.factor(periodo))) + 
  geom_bar(stat="identity", color="black", position= position_dodge2(preserve = "single")) +
  scale_fill_hue(c = 40) +
  scale_y_continuous(breaks = round(seq(0, 60, by = 5),1)) +
  xlab("Ano") + ylab("N?mero de Alunos") + labs(fill = "Per?odo") + ggtitle("An?lise do N? de Alunos por Disciplina, Per?odo e Ano") +
  theme(axis.text.x = element_text(face = "bold", size = 6), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~componente.curricular)




aux <- as.data.frame(
  alexandro %>% 
    group_by(ano, periodo, componente.curricular, situa??o) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

aux <- as.data.frame(aux %>% 
              group_by(ano, periodo, componente.curricular) %>% 
              mutate(percent = 100*round(n/sum(n),2)))

aux <- as.data.frame(aux %>% 
                       group_by(ano, periodo, componente.curricular) %>% 
                       mutate(pos = (round(cumsum(percent) - (0.5 * percent),2))))

ggplot() + 
  geom_bar(data = aux, aes(x = as.factor(ano), y = percent, group = periodo, fill = as.factor(situa??o)), stat = "identity", color = "black") +
  scale_fill_manual(values = c("green","red","orange")) +
  geom_text(data=aux, aes(x = as.factor(ano), y = pos, label = paste0(percent,"%")), size = 4) +
  scale_y_continuous(breaks = round(seq(0, 100, by = 10),1)) +
  xlab("Ano") + ylab("Percentual de Alunos") + labs(fill = "Situa??o") + ggtitle("Situa??o de Alunos por Disciplina, Per?odo e Ano") +
  theme(legend.position = "bottom", axis.line = element_line(size=1, colour = "black"),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    panel.border = element_blank(), panel.background = element_blank(),
    plot.title=element_text(hjust = 0.5),
    axis.text.x=element_text(colour="black", size = 10),
    axis.text.y=element_text(colour="black", size = 10)) +
  facet_wrap(c("periodo","componente.curricular")) 

alexandro_2 <- alexandro
alexandro_2$situa??o[alexandro_2$situa??o == "Reprovado por Frequ?ncia"] <- "Reprovado"
alexandro_2$situa??o[alexandro_2$situa??o == "Reprovado com nota"] <- "Reprovado"

aux <- as.data.frame(
  alexandro_2 %>% 
    group_by(ano, periodo, componente.curricular, situa??o) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

aux <- as.data.frame(aux %>% 
                       group_by(ano, periodo, componente.curricular) %>% 
                       mutate(percent = 100*round(n/sum(n),2)))

aux <- as.data.frame(aux %>% 
                       group_by(ano, periodo, componente.curricular) %>% 
                       mutate(pos = (round(cumsum(percent) - (0.5 * percent),2))))

ggplot() + 
  geom_bar(data = aux, aes(x = as.factor(ano), y = percent, group = periodo, fill = as.factor(situa??o)), stat = "identity", color = "black") +
  scale_fill_manual(values = c("green","red")) +
  geom_text(data=aux, aes(x = as.factor(ano), y = pos, label = paste0(percent,"%")), size = 4) +
  scale_y_continuous(breaks = round(seq(0, 100, by = 10),1)) +
  xlab("Ano") + ylab("Percentual de Alunos") + labs(fill = "Situa??o") + ggtitle("Situa??o de Alunos por Disciplina, Per?odo e Ano") +
  theme(legend.position = "bottom", axis.line = element_line(size=1, colour = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank(),
        plot.title=element_text(hjust = 0.5),
        axis.text.x=element_text(colour="black", size = 10),
        axis.text.y=element_text(colour="black", size = 10)) +
  facet_wrap(c("periodo","componente.curricular")) 



aux <- as.data.frame(
  alexandro_2[alexandro_2$componente.curricular == "DESENHO TECNICO I",] %>% 
    group_by(ano, curso, componente.curricular, situa??o) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

aux <- as.data.frame(aux %>% 
                       group_by(ano, curso, componente.curricular) %>% 
                       mutate(percent = 100*round(n/sum(n),2)))

aux <- as.data.frame(aux %>% 
                       group_by(ano, curso, componente.curricular) %>% 
                       mutate(pos = (round(cumsum(percent) - (0.5 * percent),2))))

ggplot() + 
  geom_bar(data = aux, aes(x = as.factor(ano), y = percent, group = curso, fill = as.factor(situa??o)), stat = "identity", color = "black") +
  scale_fill_manual(values = c("green","red")) +
  geom_text(data=aux, aes(x = as.factor(ano), y = pos, label = paste0(percent,"%")), size = 4) +
  scale_y_continuous(breaks = round(seq(0, 100, by = 10),1)) +
  xlab("Ano") + ylab("Percentual de Alunos") + labs(fill = "Situa??o") + ggtitle("Situa??o de Alunos por Curso e Ano em Desenho T?cnico I") +
  theme(legend.position = "bottom", axis.line = element_line(size=1, colour = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank(),
        plot.title=element_text(hjust = 0.5),
        axis.text.x=element_text(colour="black", size = 10),
        axis.text.y=element_text(colour="black", size = 10)) +
  facet_wrap(~curso) 



aux <- as.data.frame(
  alexandro_2[alexandro_2$componente.curricular == "DESENHO TECNICO II",] %>% 
    group_by(ano, curso, componente.curricular, situa??o) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

aux <- as.data.frame(aux %>% 
                       group_by(ano, curso, componente.curricular) %>% 
                       mutate(percent = 100*round(n/sum(n),2)))

aux <- as.data.frame(aux %>% 
                       group_by(ano, curso, componente.curricular) %>% 
                       mutate(pos = (round(cumsum(percent) - (0.5 * percent),2))))

ggplot() + 
  geom_bar(data = aux, aes(x = as.factor(ano), y = percent, group = curso, fill = as.factor(situa??o)), stat = "identity", color = "black") +
  scale_fill_manual(values = c("green","red")) +
  geom_text(data=aux, aes(x = as.factor(ano), y = pos, label = paste0(percent,"%")), size = 3) +
  scale_y_continuous(breaks = round(seq(0, 100, by = 10),1)) +
  xlab("Ano") + ylab("Percentual de Alunos") + labs(fill = "Situa??o") + ggtitle("Situa??o de Alunos por Curso e Ano em Desenho T?cnico II") +
  theme(legend.position = "bottom", axis.line = element_line(size=1, colour = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank(),
        plot.title=element_text(hjust = 0.5),
        axis.text.x=element_text(colour="black", size = 8),
        axis.text.y=element_text(colour="black", size = 10)) +
  facet_wrap(~curso) 



alexandro_2 <- alexandro
alexandro_2 <- alexandro_2[alexandro_2$situa??o != "Aprovado com nota",]

aux <- as.data.frame(
  alexandro_2 %>% 
    group_by(ano, periodo, componente.curricular, situa??o) %>% 
    summarise(mean = mean(nota), 
              median = median(nota), 
              sd = sd(nota), 
              min = min(nota), 
              max = max(nota),
              n = NROW(nota),
              quartil_1st = summary(nota)[2],
              quartil_3rd = summary(nota)[5],
              IQR = summary(nota)[5] - summary(nota)[2])
)

aux <- as.data.frame(aux %>% 
                       group_by(ano, periodo, componente.curricular) %>% 
                       mutate(percent = 100*round(n/sum(n),2)))

aux <- as.data.frame(aux %>% 
                       group_by(ano, periodo, componente.curricular) %>% 
                       mutate(pos = (round(cumsum(percent) - (0.5 * percent),2))))

ggplot() + 
  geom_bar(data = aux, aes(x = as.factor(ano), y = percent, group = periodo, fill = as.factor(situa??o)), stat = "identity", color = "black") +
  scale_fill_manual(values = c("green","red")) +
  geom_text(data=aux, aes(x = as.factor(ano), y = pos, label = paste0(percent,"%")), size = 4) +
  scale_y_continuous(breaks = round(seq(0, 100, by = 10),1)) +
  xlab("Ano") + ylab("Percentual de Alunos") + labs(fill = "Situa??o") + ggtitle("Situa??o de Alunos por Disciplina, Per?odo e Ano") +
  theme(legend.position = "bottom", axis.line = element_line(size=1, colour = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank(),
        plot.title=element_text(hjust = 0.5),
        axis.text.x=element_text(colour="black", size = 10),
        axis.text.y=element_text(colour="black", size = 10)) +
  facet_wrap(c("periodo","componente.curricular"))
